# ============================================
# VyOS設定バックアップ (2026-01-07時点)
# このファイルを保存しておけば設定を復元できます
# ============================================

# --- 基本設定 ---
set system host-name 'vyos-router'
set system time-zone 'Asia/Tokyo'

# NTP設定 (VyOS Rolling Releaseでは service ntp)
set service ntp server ntp.nict.jp
set service ntp server ntp.jst.mfeed.ad.jp

# --- eth0: WXR接続 または PPPoE用 ---
# 注意: 以下は構成によって変更が必要
# 構成A: WXR経由MAP-E → 192.168.100.2/24
# 構成B: PPPoE用 → LXW-10G5に接続 (IPアドレス不要)
set interfaces ethernet eth0 description 'WAN-Secondary'

# --- eth1: WAN (IPoE/IPv6 SLAAC) ---
set interfaces ethernet eth1 description 'WAN'
set interfaces ethernet eth1 ipv6 address autoconf
set interfaces ethernet eth1 offload gro
set interfaces ethernet eth1 offload gso
set interfaces ethernet eth1 offload sg
set interfaces ethernet eth1 offload tso

# --- eth2: LAN ---
set interfaces ethernet eth2 address '192.168.1.1/24'
set interfaces ethernet eth2 description 'LAN'

# --- SSH ---
set service ssh listen-address '192.168.1.1'
set service ssh port '22'

# --- ファイアウォール IPv6 input filter ---
set firewall ipv6 input filter default-action 'drop'
set firewall ipv6 input filter rule 10 action 'accept'
set firewall ipv6 input filter rule 10 state 'established'
set firewall ipv6 input filter rule 10 state 'related'
set firewall ipv6 input filter rule 20 action 'accept'
set firewall ipv6 input filter rule 20 protocol 'ipv6-icmp'
set firewall ipv6 input filter rule 30 action 'accept'
set firewall ipv6 input filter rule 30 destination port '546'
set firewall ipv6 input filter rule 30 protocol 'udp'
set firewall ipv6 input filter rule 30 source port '547'

# --- ファイアウォール IPv6 forward filter ---
set firewall ipv6 forward filter default-action 'drop'
set firewall ipv6 forward filter rule 10 action 'accept'
set firewall ipv6 forward filter rule 10 state 'established'
set firewall ipv6 forward filter rule 10 state 'related'
set firewall ipv6 forward filter rule 10 inbound-interface name 'eth1'
set firewall ipv6 forward filter rule 20 action 'accept'
set firewall ipv6 forward filter rule 20 inbound-interface name 'eth1'
set firewall ipv6 forward filter rule 20 protocol 'ipv6-icmp'
set firewall ipv6 forward filter rule 21 action 'accept'
set firewall ipv6 forward filter rule 21 inbound-interface name 'eth1'
set firewall ipv6 forward filter rule 21 state 'new'
set firewall ipv6 forward filter rule 100 action 'accept'
set firewall ipv6 forward filter rule 100 outbound-interface name 'eth1'

# --- IPv4ルーティング (構成によって選択) ---
# 構成A: WXR経由MAP-E
# set protocols static route 0.0.0.0/0 next-hop 192.168.100.1
# set nat source rule 100 outbound-interface name 'eth0'
# set nat source rule 100 source address '192.168.1.0/24'
# set nat source rule 100 translation address 'masquerade'

# 構成B: IPv4なし (IPv6のみ)
# set protocols static route 0.0.0.0/0 blackhole

# ============================================
# DHCPv6-PD設定 (必要な場合のみ)
# VyOSでIPv6プレフィックスを取得する場合に追加
# ============================================
# set interfaces ethernet eth1 address 'dhcpv6'
# set interfaces ethernet eth1 dhcpv6-options duid '00:03:00:01:c4:62:37:08:0e:53'
# set interfaces ethernet eth1 dhcpv6-options pd 0 interface eth2 sla-id '1'
# set interfaces ethernet eth1 dhcpv6-options pd 0 length '56'

# ============================================
# PPPoE設定 (10ギガプランでは使用不可)
# ============================================
# set interfaces pppoe pppoe0 source-interface 'eth0'
# set interfaces pppoe pppoe0 authentication username 'ngh26967@biglobe.ne.jp'
# set interfaces pppoe pppoe0 authentication password 'PASSWORD'
# set interfaces pppoe pppoe0 mtu '1492'
